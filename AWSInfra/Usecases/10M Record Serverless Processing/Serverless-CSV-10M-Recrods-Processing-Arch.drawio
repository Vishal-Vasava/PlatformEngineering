<mxfile host="65bd71144e">
    <diagram id="37RX6528LyiwZoB9N7dY" name="Page-1">
        <mxGraphModel dx="906" dy="527" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="10" style="edgeStyle=none;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="2" target="3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="2" value="Amazon S3" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;strokeColor=#ffffff;fillColor=#232F3E;dashed=0;verticalLabelPosition=middle;verticalAlign=bottom;align=center;html=1;whiteSpace=wrap;fontSize=10;fontStyle=1;spacing=3;shape=mxgraph.aws4.productIcon;prIcon=mxgraph.aws4.s3;" parent="1" vertex="1">
                    <mxGeometry x="240" y="126" width="80" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="12" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="3" target="5" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="500" y="220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="13" style="edgeStyle=elbowEdgeStyle;elbow=vertical;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="3" target="4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3" value="" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.lambda_function;fillColor=#F58534;gradientColor=none;" parent="1" vertex="1">
                    <mxGeometry x="414" y="140" width="69" height="72" as="geometry"/>
                </mxCell>
                <mxCell id="15" style="edgeStyle=orthogonalEdgeStyle;html=1;elbow=vertical;" parent="1" source="4" target="14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="4" value="Amazon ECS" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;strokeColor=#ffffff;fillColor=#232F3E;dashed=0;verticalLabelPosition=middle;verticalAlign=bottom;align=center;html=1;whiteSpace=wrap;fontSize=10;fontStyle=1;spacing=3;shape=mxgraph.aws4.productIcon;prIcon=mxgraph.aws4.ecs;" parent="1" vertex="1">
                    <mxGeometry x="530" y="20" width="80" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="16" style="edgeStyle=orthogonalEdgeStyle;html=1;elbow=vertical;" parent="1" source="5" target="14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="5" value="AWS Fargate" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;strokeColor=#ffffff;fillColor=#232F3E;dashed=0;verticalLabelPosition=middle;verticalAlign=bottom;align=center;html=1;whiteSpace=wrap;fontSize=10;fontStyle=1;spacing=3;shape=mxgraph.aws4.productIcon;prIcon=mxgraph.aws4.fargate;" parent="1" vertex="1">
                    <mxGeometry x="530" y="200" width="80" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.document" parent="1" vertex="1">
                    <mxGeometry x="84" y="114" width="30" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="7" value="" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.document" parent="1" vertex="1">
                    <mxGeometry x="80" y="120" width="30" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="9" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="8" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="230" y="146" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="8" value="" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.document" parent="1" vertex="1">
                    <mxGeometry x="80" y="126" width="30" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="14" value="" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.dynamo_db;fillColor=#2E73B8;gradientColor=none;" parent="1" vertex="1">
                    <mxGeometry x="680" y="79" width="72" height="81" as="geometry"/>
                </mxCell>
                <mxCell id="18" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;elbow=vertical;" parent="1" source="17" target="14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="25" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontColor=#f3f2f2;elbow=vertical;" parent="1" source="17" target="24" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="17" value="" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.lambda_function;fillColor=#5294CF;gradientColor=none;" parent="1" vertex="1">
                    <mxGeometry x="440" y="360" width="60" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="20" style="edgeStyle=orthogonalEdgeStyle;html=1;elbow=vertical;" parent="1" source="19" target="17" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="21" style="edgeStyle=orthogonalEdgeStyle;html=1;elbow=vertical;" parent="1" source="19" target="2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="19" value="" style="aspect=fixed;html=1;points=[];align=center;image;fontSize=12;image=img/lib/azure2/general/Browser.svg;" parent="1" vertex="1">
                    <mxGeometry x="84" y="300" width="116" height="92.8" as="geometry"/>
                </mxCell>
                <mxCell id="22" value="Serverless CSV record processing at scale&lt;br style=&quot;font-size: 18px;&quot;&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=18;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="10" y="20" width="390" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="&lt;h2 style=&quot;box-sizing: border-box; font-family: AmazonEmber, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;First visit&lt;/font&gt;&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box; margin-top: 15px; margin-bottom: 15px; font-family: AmazonEmber, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; font-size: 14px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;When a user visits the web application at the first time, the flow is as follows:&lt;/font&gt;&lt;/p&gt;&lt;ol style=&quot;box-sizing: border-box; margin: 0px 0px 0px 2px; padding: 0px 0px 0px 20px; font-family: AmazonEmber, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; font-size: 14px;&quot;&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 10px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;The client side of the application (also referred to as the front end) uses the&amp;nbsp;&lt;a style=&quot;box-sizing: border-box; outline: 0px; background-color: transparent; text-underline-offset: 0.4rem;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot; href=&quot;https://docs.aws.amazon.com/AmazonS3/latest/dev/using-aws-amplify.html&quot;&gt;AWS Amplify JavaScript library&lt;/a&gt;&amp;nbsp;(Amplify.js) or AWS SDK to simplify authentication and authorization. Using Amplify, the application detects that the user is unauthenticated and redirects to Amazon Cognito, which then sends a SAML request to the IdP.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 10px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;The IdP authenticates the user and sends a SAML response back to Amazon Cognito. The SAML response includes common attributes and a multi-value attribute for group membership.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 10px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;Amazon Cognito handles the SAML response, and maps the SAML attributes to a just-in-time user profile. The SAML&amp;nbsp;&lt;em style=&quot;box-sizing: border-box;&quot;&gt;groups&lt;/em&gt;&amp;nbsp;attribute is mapped to a custom user pool attribute named&amp;nbsp;&lt;em style=&quot;box-sizing: border-box;&quot;&gt;custom:groups&lt;/em&gt;.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 10px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;An AWS Lambda function named PreTokenGeneration reads the&amp;nbsp;&lt;em style=&quot;box-sizing: border-box;&quot;&gt;custom:groups&lt;/em&gt;&amp;nbsp;custom attribute and converts it to a JSON Web Token (JWT) claim named&amp;nbsp;&lt;em style=&quot;box-sizing: border-box;&quot;&gt;cognito:groups&lt;/em&gt;. This associates the user to a group, without creating a group.This attribute conversion is optional and implemented to demo how you can use Pre Token Generation Lambda trigger to customize your JWT token claims, mapping the IdP groups to the attributes your application recognizes. You can also use this trigger to make additional authorization decisions. For example, if user is a member of multiple groups, you may choose to map only one of them.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 10px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;Amazon Cognito returns the JWT tokens to the front end.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 10px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;The Amplify client library stores the tokens and handles refreshes.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 10px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;The front end makes a call to a protected API in Amazon API Gateway.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 10px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;API Gateway uses an Amazon Cognito user pools authorizer to validate the JWT’s signature and expiration. If this is successful, API Gateway passes the JWT to the application’s Lambda function (also referred to as the&amp;nbsp;&lt;em style=&quot;box-sizing: border-box;&quot;&gt;backend&lt;/em&gt;).&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; margin-bottom: 0px;&quot;&gt;&lt;font color=&quot;#f3f2f2&quot;&gt;The backend application code reads the&amp;nbsp;&lt;em style=&quot;box-sizing: border-box;&quot;&gt;cognito:groups&lt;/em&gt;&amp;nbsp;claim from the JWT and decides if the action is allowed. If the user is a member of the right group then the action is allowed, otherwise the action is denied.&lt;/font&gt;&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="30" y="760" width="3960" height="380" as="geometry"/>
                </mxCell>
                <mxCell id="28" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;fontColor=#f3f2f2;elbow=vertical;" parent="1" source="24" target="27" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="24" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F54749;gradientDirection=north;fillColor=#C7131F;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.cognito;" parent="1" vertex="1">
                    <mxGeometry x="530" y="460" width="98" height="98" as="geometry"/>
                </mxCell>
                <mxCell id="26" value="SAML token" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;strokeColor=#232F3E;fillColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.saml_token;" parent="1" vertex="1">
                    <mxGeometry x="1040" y="479" width="81" height="81" as="geometry"/>
                </mxCell>
                <mxCell id="29" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.47;exitDx=0;exitDy=0;exitPerimeter=0;fontColor=#f3f2f2;elbow=vertical;" parent="1" source="27" target="26" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="27" value="" style="outlineConnect=0;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;shape=mxgraph.aws3.saml_token;fillColor=#D2D3D3;gradientColor=none;fontColor=#f3f2f2;" parent="1" vertex="1">
                    <mxGeometry x="860" y="473" width="79" height="87" as="geometry"/>
                </mxCell>
                <mxCell id="30" value="IDP / SAM:" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#f3f2f2;" parent="1" vertex="1">
                    <mxGeometry x="1000" y="585" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="31" value="" style="rounded=1;whiteSpace=wrap;html=1;fontColor=#f3f2f2;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="830" y="450" width="330" height="190" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#FF4F8B;gradientDirection=north;fillColor=#BC1356;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.api_gateway;" parent="1" vertex="1">
                    <mxGeometry x="260" y="330" width="78" height="78" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>